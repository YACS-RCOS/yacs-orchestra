version: '3'

services:
  postgres:
    restart: unless-stopped

  redis:
    restart: unless-stopped

  nginx:
    restart: unless-stopped

  core:
    restart: unless-stopped
    environment:
      - RAILS_ENV=production
      - SECRET_KEY_BASE=${SECRET_KEY_BASE}
      - SECRET_TOKEN=${SECRET_TOKEN}
      - WEB_CONCURRENCY=${WEB_CONCURRENCY}
      - MAX_THREADS=${MAX_THREADS}

  worker:
    restart: unless-stopped
    environment:
      - RAILS_ENV=production

  web:
    restart: unless-stopped

  # admin:
  #   restart: unless-stopped

  users:
    restart: unless-stopped

  malg:
    restart: unless-stopped
